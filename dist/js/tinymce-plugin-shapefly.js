/*! shapefly-plugin 2015-09-04 */
!function(a){"use strict";window.shapefly=window.shapefly||{},a(window.shapefly)}(function(a){var b=function(){for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b];if(/shapefly/i.test(c.href))return c.href.split("?")[0].split("/").slice(0,-1).join("/")+"/"}var d=document.getElementsByTagName("script");return d[d.length-1].src.split("?")[0].split("/").slice(0,-1).join("/")+"/"},c=b(),d=function(a,b){this.el=a;var d=a.id;if(void 0===d){var e=0;for(d="_shapefly"+e;null!=document.getElementById(d);)e++,d="_shapefly"+e}this.opt={url:"//shapefly.com/editor/",proxy:c+(b.html||"shapefly-plugin.html"),parent:window.location.href,refid:d};for(var f in b)this.opt[f]=b[f]};d.prototype={constructor:d,open:function(a){a&&(this.opt.uuid=a);var b=JSON.stringify(this.opt);return window.open(this.opt.url,b),!1},initEditTag:function(a){a||(a=document.body);var b=a.ownerDocument.getElementById("sfEditag");if(b)b.style.display="none";else{var c=document.createElement("div");c.innerHTML='<span id="sfEditag" style="position:absolute;display:none;" contentEditable="false"><a href="#" class="btn btn-default" title="Shapefly">Edit</a></span>',b=c.childNodes[0],a.appendChild(b)}this.edit=b;var d=function(a){return function(){a.open()}}(this),e=function(a){return function(b){var c=b.target,d=c.getAttribute("data-sf-uuid");if(d){var e=c.offsetLeft,f=c.offsetTop;a.edit.style.left=e+"px",a.edit.style.top=f+"px",a.edit.style.display="block",a.opt.uuid=d}}}(this),f=function(a){return function(){a.edit.style.display="none",a.opt.uuid=null}}(this);a.addEventListener?(a.addEventListener("mouseover",e,!1),a.addEventListener("mouseleave",f,!1),b.addEventListener("click",d,!1)):(a.attachEvent("mouseover",e),a.attachEvent("mouseleave",f),b.attachEvent("click",d))}},a.__shapeflyplugins=[],a.plugin=function(b,c){var e=null;if("string"==typeof b){console.log(b);var f=JSON.parse(b);e=a.__shapeflyplugins[f.refid];var g='<img src="'+f.data+'" data-sf-uuid="'+f.uuid+'" title="'+f.name+"\nProudly by "+e.opt.url+'"/>';e.opt.finish(g,f)}else e=new d(b,c),a.__shapeflyplugins[e.opt.refid]=e;return e}});/*! tinymce-plugin-shapefly 2015-09-20 */
tinymce.create("tinymce.plugins.shapefly",{init:function(a){var b=a.editorId||a.id,c=document.getElementById(b),d=shapefly.plugin(c,{url:"http://shapefly.com/editor",finish:function(a){tinymce.execCommand("mceInsertContent",!0,a)}});a.on("init",function(){d.initEditTag(a.dom.doc.body)}),a.addButton("shapefly",{tooltip:"Insert ready-made shapes from shapefly.com,such as rectangles and circles, arrows, lines, flowchart symbols, and callouts.",title:"Shapefly",icon:"shapefly",onclick:function(){var b=a.selection.getContent(),c=null;if(""!==b){var e=document.createElement("div");e.innerHTML=b;var f=e.childNodes[0];c=f.getAttribute("data-sf-uuid"),console.log(c)}d.open(c)}})},createControl:function(){return null},getInfo:function(){return{longname:"Insert ready-made shapes,such as rectangles and circles, arrows, lines, flowchart symbols, and callouts.",author:"zzzhan",authorurl:"http://github.com/zzzhan",infourl:"http://github.com/zzzhan/tinymce-plugin-shapefly",version:"0.1.0"}}}),tinymce.PluginManager.add("shapefly",tinymce.plugins.shapefly);